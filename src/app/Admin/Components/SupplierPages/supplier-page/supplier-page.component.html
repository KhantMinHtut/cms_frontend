<main *ngIf="!(isPageLoading || changeForm)">
  <div class="w-100 p-0 d-flex align-items-center justify-content-between a">
    <div class="w-100 d-flex align-items-center scroll" style="flex: 1">
      <div class="myCard" matTooltip="Total Suppliers">
        <div class="title">
          <span class="show-text user-select-none">Total Suppliers</span>
          <span class="show-icon">
            <i class="bi bi-grid"></i>
          </span>
        </div>
        <div class="content mt-2 user-select-none">
          {{ supplierCount }}
        </div>
      </div>
    </div>
    <div class="">
      <!-- <div class="myBotton" (click)="onChangePage()">
        <div class="title">
          <span class="btnIcon"><i class="bi bi-cart-plus-fill"></i></span>
          <span class="d-none d-sm-inline d-md-inline-block user-select-none"
            >create supplier</span
          >
        </div>
      </div> -->

      <button class="addBtn" mat-fab extended (click)="changeForm = true">
        <mat-icon>person_add</mat-icon>
        <span class="hidden">Add Supplier</span>
      </button>
    </div>
  </div>

  <!-- ======================================================== -->
  <div class="w-100">
    <div class="mt-3 p-0 container-fluid table-responsive table-container">
      <section class="table-header">
        <h3>Supplier's Info</h3>
        <div class="d-flex">
          <span
            (click)="searchBox('open')"
            (mouseleave)="searchBox('close')"
            class="d-xl-none d-lg-none d-md-none d-sm-inline-block d-inline-block align-content-center justify-content-center rounded"
            style="background-color: #aa715a; color: white; cursor: pointer"
          >
            <span [ngClass]="searchIcon" class="mt-1 mb-1 ml-2 mr-2"
              ><i class="bi bi-search"></i
            ></span>
            <span [ngClass]="searchInput">
              <input
                class="form-control me-2"
                type="search"
                placeholder="Search"
                aria-label="Search"
                style="border-radius: 13px"
                (keyup)="onSearch($event)"
              />
            </span>
          </span>
          <span
            class="d-xl-inline-block d-lg-inline-block d-md-inline-block d-sm-none d-none"
          >
            <input
              class="form-control me-2"
              type="search"
              placeholder="Search"
              aria-label="Search"
              style="border-radius: 13px"
              (keyup)="onSearch($event)"
            />
          </span>
        </div>
      </section>
      <section class="table-body">
        <table class="table-striped">
          <thead>
            <tr>
              <th class="text-center">No.</th>
              <th class="text-center">Name</th>
              <th class="text-center d-inline-block" style="width: 160px">
                Contact Person
              </th>
              <th class="text-center">Phone</th>
              <th class="text-center">Email</th>

              <th class="text-center">Action</th>
            </tr>
          </thead>
          @if (paginatedSuppliers.length == 0) {
          <tbody
            style="
              width: 100%;
              height: 400px;

              display: flex;
              justify-content: center;
              align-items: center;

              position: absolute;
            "
          >
            <span style="font-size: 30px; font-weight: bolder; color: #aa715a"
              >No suppliers available</span
            >
          </tbody>
          } @else {

          <tbody>
            @for (supplier of paginatedSuppliers; track supplier; let i =
            $index) {

            <tr>
              <td class="text-center">
                {{ (currentPage - 1) * pageSize + i + 1 }}
              </td>

              <td class="text-center" style="width: 250px">
                {{ supplier.name }}
              </td>

              <td class="text-center">
                {{ supplier.contact_person }}
              </td>
              <td class="text-center">{{ supplier.phone }}</td>
              <td class="text-center">{{ supplier.email }}</td>

              <td class="text-center">
                <span>
                  <span
                    class="btn btn-sm btn-primary m-1"
                    (click)="onUpdateSupplier(supplier)"
                    ><i class="bi bi-pencil-square"></i
                  ></span>
                  <span
                    class="btn btn-sm btn-primary m-1"
                    (click)="onDeletedSupplier(supplier._id!)"
                    ><i class="bi bi-trash3-fill"></i
                  ></span>
                </span>
              </td>
            </tr>
            }
          </tbody>

          }
        </table>
      </section>

      <section class="table-pagination">
        <nav aria-label="Page navigation example">
          <ul
            class="pagination justify-content-center"
            style="margin-bottom: 0"
          >
            <li
              style="cursor: pointer"
              [attr.aria-disabled]="currentPage == 1"
              [class.disabled]="currentPage == 1"
              (click)="!(currentPage == 1) && fetchData(currentPage - 1)"
            >
              <!-- <span class="page-link">Previous</span> -->
              <span aria-hidden="true" class="page-link">&laquo;</span>
            </li>
            @for (item of pages; track item; let i = $index) {

            <li
              class="page-item"
              (click)="fetchData(i + 1)"
              [class.active]="currentPage == i + 1"
            >
              <span class="page-link">{{ i + 1 }}</span>
            </li>
            }

            <li
              style="
                cursor: pointer;
                display: flex;
                justify-content: center;
                align-items: center;
              "
              [attr.aria-disabled]="pages[pages.length - 1] < currentPage + 1"
              [class.disabled]="pages[pages.length - 1] < currentPage + 1"
              (click)="
                !(pages[pages.length - 1] < currentPage + 1) &&
                  fetchData(currentPage + 1)
              "
            >
              <!-- <span class="page-link">Next</span> -->
              <span aria-hidden="true" class="page-link">&raquo;</span>
            </li>
          </ul>
        </nav>
      </section>
    </div>
  </div>
</main>

<section class="customer-form w-100 h-100" *ngIf="changeForm">
  <div class="container-fluid">
    <div class="row backBtnRow">
      <button
        mat-fab
        class="back-btn"
        style="background-color: #aa715a"
        (click)="onChangePage()"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
    </div>
  </div>
  <div class="w-100 py-2 px-3 mt-3">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-container">
        <div class="input-container">
          <label for="name">Name <span style="color: red">*</span></label>
          <div style="flex: 1">
            <input
              placeholder="Enter name"
              type="text"
              formControlName="name"
              class="form-control"
            />

            <small
              class="text-danger"
              *ngIf="
                (form.get('name')?.touched || submitted) &&
                form.get('name')?.errors
              "
            >
              <span *ngIf="form.get('name')?.errors?.['required']"
                >*Name is required.</span
              >
              <span *ngIf="form.get('name')?.errors?.['minlength']"
                >*Minimum 3 characters.</span
              >
            </small>
          </div>
        </div>

        <div class="input-container">
          <label for="name"
            >Contact person <span style="color: red">*</span></label
          >
          <div style="flex: 1">
            <input
              placeholder="Enter contact person"
              type="text"
              formControlName="contact_person"
              class="form-control"
            />

            <small
              class="text-danger"
              *ngIf="
                (form.get('contact_person')?.touched || submitted) &&
                form.get('contact_person')?.errors
              "
            >
              <span *ngIf="form.get('contact_person')?.errors?.['required']"
                >*Contact person is required.</span
              >
            </small>
          </div>
        </div>

        <div class="input-container">
          <label for="name">Email <span style="color: red">*</span></label>
          <div style="flex: 1">
            <input
              placeholder="Enter email"
              type="email"
              formControlName="email"
              class="form-control"
            />

            <small
              class="text-danger"
              *ngIf="
                (form.get('email')?.touched || submitted) &&
                form.get('email')?.errors
              "
            >
              <span *ngIf="form.get('email')?.errors?.['required']"
                >*Email is required.</span
              >
              <span *ngIf="form.get('email')?.errors?.['email']"
                >*Enter a valid email.</span
              >
            </small>
          </div>
        </div>

        <div class="input-container">
          <label for="name">Phone <span style="color: red">*</span></label>
          <div style="flex: 1">
            <input
              placeholder="Enter phone number"
              type="text"
              formControlName="phone"
              class="form-control"
            />

            <small
              class="text-danger"
              *ngIf="
                (form.get('phone')?.touched || submitted) &&
                form.get('phone')?.errors
              "
            >
              <span *ngIf="form.get('phone')?.errors?.['required']"
                >*Phone is required.</span
              >
              <span *ngIf="form.get('phone')?.errors?.['pattern']"
                >*Enter 11-digit number.</span
              >
            </small>
          </div>
        </div>
      </div>

      <div
        class="w-100 px-3 py-3 mt-3 d-flex align-items-center justify-content-center"
      >
        <button mat-raised-button>
          <mat-progress-spinner
            *ngIf="formLoading"
            diameter="20"
            mode="indeterminate"
          ></mat-progress-spinner>

          <span *ngIf="!formLoading">Save</span>
          <span *ngIf="formLoading" class="ml-2">Savingâ€¦</span>
        </button>
      </div>
    </form>
  </div>
</section>

<section
  *ngIf="isPageLoading"
  class="w-100 h-100 d-flex flex-column justify-content-center align-items-center"
>
  <app-coffee-seed-loading></app-coffee-seed-loading>
  <div style="width: 100%; height: 15%"></div>
</section>
