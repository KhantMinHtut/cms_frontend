<section class="pos-terminal" *ngIf="!isLoading">
  <section class="menu-select">
    <div class="w-100 d-flex align-items-center">
      <div class="search-container-row">
        <!-- Search Box -->
        <div class="search-container">
          <input
            type="text"
            [(ngModel)]="searchText"
            (keyup)="onSearchProduct()"
          />
          <div
            class="search-clear"
            matRipple
            [matRippleColor]="'#aa715a20'"
            *ngIf="searchText"
            (click)="searchText = ''; onSearchProduct()"
          >
            <i class="bi bi-x-lg"></i>
          </div>
          <div class="search-btn" matRipple [matRippleColor]="'#ffffff19'">
            <i class="bi bi-search"></i>
          </div>
        </div>
      </div>
      <button
        class="shop-icon-container"
        [disabled]="selectedMenuItems.length == 0"
        [ngStyle]="{
          cursor: selectedMenuItems.length == 0 ? 'none' : 'pointer'
        }"
        (click)="isOrder = true"
      >
        <span><i class="bi bi-cart4"></i> </span>
        <span *ngIf="selectedMenuItems.length != 0" class="shop-badge"
          ><span>{{ totalProduct }}</span></span
        >
      </button>
    </div>

    <div class="products-container">
      <div class="category-container">
        <div class="category-list">
          <span
            class="category-item category-active"
            [ngClass]="{ 'category-active': category_status === 'all' }"
            (click)="onCategorySelect('all')"
          >
            <span>All</span><span>({{ all_product_count }})</span>
          </span>

          <span
            class="category-item"
            [ngClass]="{ 'category-active': category_status === 'hot' }"
            (click)="onCategorySelect('hot')"
          >
            <span>Hot</span><span>({{ hot_product_count }})</span>
          </span>

          <span
            class="category-item"
            [ngClass]="{ 'category-active': category_status === 'cold' }"
            (click)="onCategorySelect('cold')"
          >
            <span>Cold</span><span>({{ cold_product_count }})</span>
          </span>

          <span
            class="category-item"
            [ngClass]="{ 'category-active': category_status === 'deserts' }"
            (click)="onCategorySelect('deserts')"
          >
            <span>Deserts</span><span>({{ desert_product_count }})</span>
          </span>
        </div>
      </div>
      <!-- Products Card UI Container -->
      <div class="products-item-container" *ngIf="isLoading">
        <!-- <app-loading class="mt-5"></app-loading> -->
        <app-coffee-seed-loading class="mt-5"></app-coffee-seed-loading>
      </div>
      <div
        class="products-item-container"
        *ngIf="!isLoading && filterProducts.length > 0"
      >
        @for (product of filterProducts; track $index) {

        <div class="product-card">
          <!-- <div class="out-of-stock" *ngIf="product.stock_quantity === 0">
            <span>Out of Stock</span>
          </div> -->
          <div class="product-count" *ngIf="product.stock_quantity != 0">
            {{ product.stock_quantity }}
          </div>

          <!-- Discount Badge -->
          <div
            class="discount-badge"
            *ngIf="product.discount && product.discount > 0"
          >
            -{{ product.discount }}%
          </div>
          <div class="image-container position-relative">
            <div class="out-of-stock" *ngIf="product.stock_quantity === 0">
              <span>Out of Stock</span>
            </div>
            <img
              [src]="product.image_url"
              style="width: 100%; height: 100%"
              alt="product-image"
            />
          </div>
          <div class="product-info">
            <span class="product-name">{{ product.name }}</span>
            <div
              class="w-100 d-flex justify-content-between align-items-center"
              style="padding: 3px; color: #8b5641"
            >
              <div class="d-flex flex-column position-relative">
                <span
                  class="price"
                  [ngClass]="{ 'old-price': product.discount }"
                  >{{ product.price }} MMK</span
                >
                <!-- ðŸ”¹ Show discounted price -->
                <span class="discount-price" *ngIf="product.discount">
                  {{ product.price - (product.price * product.discount) / 100 }}
                  MMK
                </span>
              </div>
              <span
                matRipple
                [matRippleColor]="'#aa715a20'"
                class="add-product"
                (click)="onSelectedMenu(product)"
                >{{ product.stock_quantity != 0 ? "Add" : "-" }}</span
              >
            </div>
          </div>
        </div>

        }
      </div>
      <div
        class="products-item-container"
        *ngIf="!isLoading && filterProducts.length === 0"
      >
        <div class="no-product-found">
          <img
            src="../../assets/images/no-product-found.png"
            alt="product-not-found"
          />
          <h3 class="mb-3">No Product Found</h3>
        </div>
      </div>
    </div>
  </section>
  <section
    class="sd-container"
    [ngStyle]="{
      width: isOrder && selectedMenuItems.length != 0 ? '300px' : '0'
    }"
  >
    <section
      class="sales-details"
      [ngStyle]="{
        left: isOrder && selectedMenuItems.length != 0 ? '0' : '100%'
      }"
    >
      <div class="w-100 d-flex align-items-center" style="gap: 0.4rem">
        <div
          class="customer-info-btn"
          matRipple
          [matRippleColor]="'#ffffff19'"
          (click)="openPopup('Add Customer Info', newCustomer)"
        >
          <span
            ><i class="bi bi-plus-circle" style="font-size: 1.2rem"></i
          ></span>
          <span>Add customer info</span>
        </div>

        <div class="close-order-btn" (click)="isOrder = false">
          <span><i class="bi bi-x-lg"></i></span>
        </div>
      </div>

      <div class="selectedMenuItems">
        @for (product of selectedMenuItems; track i; let i=$index) {
        <!-- Menu Item Start -->
        <div class="selected-menu-item">
          <div class="menu-image">
            <img
              [src]="product.product.image_url"
              alt="menu"
              style="width: 100%; height: 100%"
            />
          </div>
          <div class="menu-content-container">
            <div class="name-deleteBtn">
              <span class="d-flex align-items-center" style="gap: 0.5rem">
                <span>{{ product.product.name }}</span>
                <!-- ðŸ”¹ Discount Badge -->
                <div class="sd-discount-badge" *ngIf="product.product.discount">
                  -{{ product.product.discount }}%
                </div>
              </span>
              <span class="delete-btn" (click)="onRemoveMenu(i, product)"
                ><i class="bi bi-trash"></i
              ></span>
            </div>
            <div class="price-count">
              <span class="d-flex align-items-center" style="gap: 5px">
                <span [ngClass]="{ 'sd-old-price': product.product.discount }"
                  >{{ product.product.price * product.count }} MMK</span
                >
                <span *ngIf="product.product.discount"
                  >{{
                    product.product.price * product.count -
                      (product.product.price *
                        product.count *
                        product.product.discount) /
                        100
                  }}
                  MMK</span
                >
              </span>
              <span class="count-container">
                <span
                  class="count-btn"
                  [ngClass]="{ disabled: product.count === 1 }"
                  (click)="setCount('decrease', i, product.product._id)"
                  ><i class="bi bi-dash"></i
                ></span>
                <span class="count">{{ product.count }}</span>
                <span
                  class="count-btn"
                  [ngClass]="{ disabled: product.product.stock_quantity === 0 }"
                  (click)="setCount('increase', i, product.product._id)"
                  ><i class="bi bi-plus-lg"></i
                ></span>
              </span>
            </div>
          </div>
        </div>
        <!-- Menu Item End -->
        }
      </div>

      <div class="payment-info">
        <div class="pi-item">
          <span>Sub Total</span> <span>{{ subTotalPrice }} MMK</span>
        </div>
        <div class="pi-item">
          <span>Discount</span> <span>{{ discountAmount }} MMK</span>
        </div>

        <div class="pi-divider"></div>

        <div class="pi-item" style="font-size: 0.95rem">
          <span>Total</span> <span>{{ totalPrice }} MMK</span>
        </div>
      </div>

      <div class="payment-method">
        <span class="p-title">Payment Method</span>
        <div class="payment-type">
          <div class="payment-card" (click)="paymentMethod = 'cash'">
            <div
              class="payment-icon"
              [ngClass]="{ selectedMethod: paymentMethod === 'cash' }"
            >
              <span><i class="bi bi-currency-dollar"></i></span>
            </div>
            <div class="payment-text">Cash</div>
          </div>

          <div class="payment-card" (click)="paymentMethod = 'Kpay'">
            <div
              class="payment-icon"
              [ngClass]="{ selectedMethod: paymentMethod === 'Kpay' }"
            >
              <img src="../../assets/images/kpay-icon.png" alt="Kpay" />
            </div>
            <div class="payment-text">K pay</div>
          </div>

          <div class="payment-card" (click)="paymentMethod = 'Wavepay'">
            <div
              class="payment-icon"
              [ngClass]="{ selectedMethod: paymentMethod === 'Wavepay' }"
            >
              <img src="../../assets/images/wave-pay-icon.png" alt="Wavepay" />
            </div>
            <div class="payment-text">Wave pay</div>
          </div>
        </div>

        <div class="w-100">
          <span
            matRipple
            [matRippleColor]="'#ffffff19'"
            class="pay-btn"
            (click)="onCheckout()"
            >Checkout</span
          >
        </div>
      </div>
    </section>
  </section>
</section>

<section
  *ngIf="isLoading"
  class="w-100 h-100 d-flex flex-column justify-content-center align-items-center"
>
  <app-coffee-seed-loading></app-coffee-seed-loading>
  <div style="width: 100%; height: 15%"></div>
</section>
